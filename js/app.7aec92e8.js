(function(t){function n(n){for(var o,i,r=n[0],c=n[1],u=n[2],h=0,m=[];h<r.length;h++)i=r[h],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&m.push(a[i][0]),a[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);d&&d(n);while(m.length)m.shift()();return s.push.apply(s,u||[]),e()}function e(){for(var t,n=0;n<s.length;n++){for(var e=s[n],o=!0,r=1;r<e.length;r++){var c=e[r];0!==a[c]&&(o=!1)}o&&(s.splice(n--,1),t=i(i.s=e[0]))}return t}var o={},a={app:0},s=[];function i(n){if(o[n])return o[n].exports;var e=o[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=t,i.c=o,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)i.d(e,o,function(n){return t[n]}.bind(null,o));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="/facade-cutter/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=n,r=r.slice();for(var u=0;u<r.length;u++)n(r[u]);var d=c;s.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"034f":function(t,n,e){"use strict";var o=e("85ec"),a=e.n(o);a.a},"4d33":function(t,n,e){},"56d7":function(t,n,e){"use strict";e.r(n);e("e260"),e("e6cf"),e("cca6"),e("a79d");var o,a,s=e("2b0e"),i=e("8c4f"),r=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"app"}},[e("main",[e("div",{staticClass:"container"},[t.done?[e("p",{staticClass:"text"},[t._v("Done! All work is done.")])]:t.error?[e("p",{staticClass:"text error"},[t._v(t._s(t.error))])]:t.$route.params.poiId?t.data&&"edit"===t.$route.name?[e("EditFacade",{attrs:{data:t.data,saveAnnotation:t.saveAnnotation}})]:t._e():[e("span",{staticClass:"text loading"},[t._v("Loadingâ€¦")])]],2)])])},c=[],u=(e("b0c0"),e("96cf"),e("1da1")),d=function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.screenshotAnnotation?e("div",{staticClass:"edit"},["show"===t.$route.query.metadata?[e("h2",[t._v(t._s(t.name)+" ")]),e("h3",[t._v(t._s(t.addressAnnotation.data.address))])]:t._e(),e("div",{staticClass:"facade"},[e("img",{attrs:{src:t.screenshotUrl}}),e("svg",{ref:"svg",attrs:{viewBox:"0 0 2880 1800",xmlns:"http://www.w3.org/2000/svg"}},[e("g",[e("polygon",{attrs:{points:t.polygonPoints()}})]),e("g",t._l(t.mask,(function(n,o){var a=n.x,s=n.y;return e("circle",{key:o,ref:"point"+o,refInFor:!0,attrs:{cx:a,cy:s,r:"30"},on:{mousedown:function(n){return t.circleMousedown(n,o)},touchstart:function(n){return t.circleTouchstart(n,o)}}})})),0)])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"gradient-button gradient-button-primary",attrs:{disabled:t.saved},on:{click:t.save}},[t._v(" "+t._s(t.saved?"Saved!":"Save")+" ")]),e("button",{staticClass:"gradient-button",on:{click:t.next}},[t._v("Skip")]),e("button",{staticClass:"gradient-button gradient-button-secondary",on:{click:t.next}},[t._v("Next")]),e("span",[t._v(t._s(t.message))])])],2):t._e()},h=[],m=(e("4de4"),e("a15b"),e("d81d"),e("90e6")),l={props:{data:Object,saveAnnotation:Function},data:function(){return{color:"#ff86e1",saved:!1,message:"",dimensions:[],mask:[]}},watch:{data:function(){this.newAnnotations()}},mounted:function(){this.newAnnotations(),document.addEventListener("mouseup",this.mouseupHandler),document.addEventListener("touchend",this.touchendHandler)},beforeDestroy:function(){document.removeEventListener("mouseup",this.mouseupHandler),document.removeEventListener("touchend",this.touchendHandler)},computed:{name:function(){return this.osmAnnotation?this.osmAnnotation.data.properties.name:this.faillissementsdossierAnnotation?this.faillissementsdossierAnnotation.data.name:""},screenshotUrl:function(){return this.screenshotAnnotation?this.screenshotAnnotation.data.screenshotUrl:""},faillissementsdossierAnnotation:function(){return this.annotationsOfType(this.data.annotations,"faillissementsdossier")[0]},addressAnnotation:function(){return this.annotationsOfType(this.data.annotations,"address")[0]},osmAnnotation:function(){return this.annotationsOfType(this.data.annotations,"osm")[0]},facadeAnnotation:function(){return this.annotationsOfType(this.data.annotations,"facade")[0]},screenshotAnnotation:function(){return this.annotationsOfType(this.data.annotations,"screenshot")[0]}},methods:{newAnnotations:function(){this.screenshotAnnotation&&(this.dimensions=this.screenshotAnnotation.data.dimensions),this.facadeAnnotation?(this.mask=this.facadeAnnotation.data.mask,this.saved=!0):this.screenshotAnnotation&&(this.mask=this.makeInitialMask(this.dimensions,200),this.saved=!1)},annotationsOfType:function(t,n){return t.filter((function(t){return t.type===n}))},save:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){var n,e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.data.id,e=this.facadeAnnotation&&this.facadeAnnotation.id,t.prev=2,t.next=5,this.saveAnnotation(n,"facade",{mask:this.mask},e);case 5:this.saved=!0,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](2),this.message="Error saving: ".concat(t.t0.message,"!");case 11:case"end":return t.stop()}}),t,this,[[2,8]])})));function n(){return t.apply(this,arguments)}return n}(),next:function(){this.$router.push({name:"main",query:this.$route.query})},reset:function(){this.facadeAnnotation?(this.mask=this.facadeAnnotation.data.mask,this.saved=!0):(this.mask=this.makeInitialMask(this.dimensions,200),this.saved=!1)},touchendHandler:function(){this.touchmoveHandler&&document.removeEventListener("touchmove",this.touchmoveHandler)},mouseupHandler:function(){this.mousemoveHandler&&document.removeEventListener("mousemove",this.mousemoveHandler)},makeInitialMask:function(t,n){var e=0,o=0,a=t[0],s=t[1];return[{x:e+n,y:o+n},{x:a-n,y:o+n},{x:a-n,y:s-n},{x:e+n,y:s-n}]},polygonPoints:function(){return this.mask.map((function(t){return[t.x,t.y].join(",")})).join(" ")},circleMousedown:function(t,n){var e=this;this.mousemoveHandler=function(t){return e.circleMousemove(t,n)},document.addEventListener("mousemove",this.mousemoveHandler)},circleTouchstart:function(t,n){var e=this;this.touchmoveHandler=function(t){return e.circleTouchmove(t,n)},document.addEventListener("touchmove",this.touchmoveHandler)},circleTouchmove:function(t,n){var e=t.touches[0].pageX,o=t.touches[0].pageY;this.circleMove(e,o,n)},circleMousemove:function(t,n){var e=t.pageX,o=t.pageY;this.circleMove(e,o,n)},circleMove:function(t,n,e){var o=this.$refs.svg,a=o.createSVGPoint();a.x=t,a.y=n;var s=a.matrixTransform(o.getScreenCTM().inverse()),i=Math.round(s.x),r=Math.round(s.y),c={x:Math.min(Math.max(0,i),this.dimensions[0]),y:Math.min(Math.max(0,r),this.dimensions[1])};this.mask=Object(m["a"])(e,c,this.mask),this.saved=!1}}},f=l,p=(e("c574"),e("2877")),v=Object(p["a"])(f,d,h,!1,null,"0003b8be",null),y=v.exports,g=(e("99af"),e("bc3a")),b=e.n(g),x="https://us-central1-streetswipe-aoe.cloudfunctions.net/annotations",w={data:function(){return{data:void 0,done:!1,error:void 0}},methods:{saveAnnotation:function(t,n,e,o){var a;return a=o?"".concat(x,"/").concat(t,"/").concat(n,"/").concat(o):"".concat(x,"/").concat(t,"/").concat(n),b.a.post(a,e)},loadAnnotations:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(n,e){var o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=n?"".concat(x,"/").concat(n):"".concat(x,"/next/facade").concat(e?"?source=".concat(e):""),t.prev=1,t.next=4,b.a.get(o);case 4:a=t.sent,this.data=a.data,this.error=void 0,this.done=!1,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),t.t0.response&&404===t.t0.response.status?this.done=!0:this.error=t.t0.message;case 13:case"end":return t.stop()}}),t,this,[[1,10]])})));function n(n,e){return t.apply(this,arguments)}return n}()}},A=w,k=Object(p["a"])(A,o,a,!1,null,null,null),_=k.exports,O={name:"App",mixins:[_],components:{EditFacade:y},data:function(){return{}},watch:{"$route.params.poiId":function(){this.loadAnnotations(this.$route.params.poiId,this.$route.query.source)},poiId:function(t){t!==this.$route.params.poiId&&this.$router.push({name:"edit",params:{poiId:t},query:this.$route.query})}},computed:{poiId:function(){return this.data&&this.data.id}},mounted:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:"main"===this.$route.name?this.loadAnnotations(void 0,this.$route.query.source):this.loadAnnotations(this.$route.params.poiId);case 1:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}()},M=O,j=(e("034f"),Object(p["a"])(M,r,c,!1,null,null,null)),$=j.exports;s["a"].use(i["a"]),s["a"].config.productionTip=!1;var T=new i["a"]({routes:[{name:"main",path:"/",component:$},{name:"edit",path:"/edit/:poiId",component:$}]});new s["a"]({render:function(t){return t($)},router:T}).$mount("#app")},"85ec":function(t,n,e){},c574:function(t,n,e){"use strict";var o=e("4d33"),a=e.n(o);a.a}});
//# sourceMappingURL=app.7aec92e8.js.map